<!DOCTYPE html>

<html class="light" lang="ru"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Карточка ВУЗа (Детали)</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24;
        }
    </style>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#137fec",
              "background-light": "#f6f7f8",
              "background-dark": "#101922",
              "card-light": "#ffffff",
              "card-dark": "#18232f",
              "border-light": "#e5e7eb",
              "border-dark": "#374151",
              "text-primary-light": "#111827",
              "text-primary-dark": "#f9fafb",
              "text-secondary-light": "#6b7280",
              "text-secondary-dark": "#9ca3af",
              "accent-green": "#00C853",
              "accent-orange": "#FF9800",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
          },
        },
      }
    </script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-primary-light dark:text-text-primary-dark">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
<header class="sticky top-0 z-50 w-full bg-card-light dark:bg-card-dark border-b border-border-light dark:border-border-dark shadow-sm">
<div class="flex items-center justify-between whitespace-nowrap px-6 lg:px-10 py-3 max-w-7xl mx-auto">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3 text-text-primary-light dark:text-text-primary-dark">
<div class="size-6 text-primary">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-xl font-bold tracking-tight">UniGuide</h2>
</div>
</div>
<div class="hidden md:flex flex-1 items-center justify-center">
<div class="flex items-center gap-9">
<a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="index.html">Home</a>
<a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="#">Programs</a>
<a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="sravnenie.html">Compare</a>
<a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="#">About</a>
</div>
</div>
<div class="flex items-center gap-2">
<button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
<span class="truncate">Sign Up</span>
</button>
<button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-background-light dark:bg-card-dark text-text-primary-light dark:text-text-primary-dark border border-border-light dark:border-border-dark hover:bg-gray-100 dark:hover:bg-gray-700 text-sm font-bold leading-normal tracking-[0.015em] transition-colors">
<span class="truncate">Log In</span>
</button>
</div>
</div>
</header>
<main class="w-full max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
<div class="bg-cover bg-center flex flex-col justify-end overflow-hidden rounded-xl min-h-80 shadow-lg" id="header-image-container">
<div class="flex flex-col p-6 sm:p-8">
<div class="flex flex-wrap items-center text-sm font-medium text-white/80">
<a class="hover:text-white" href="index.html">Home</a>
<span class="mx-2">/</span>
<span class="text-white font-semibold" id="uni-name-breadcrumb">Загрузка...</span>
</div>
<h1 class="text-white tracking-tight text-4xl sm:text-5xl font-bold mt-2" id="uni-name">Загрузка...</h1>
<div class="flex items-center mt-2 gap-2 text-white/90">
<span class="material-symbols-outlined !text-xl">location_on</span>
<span id="uni-city">...</span>
</div>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mt-8">
<div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
<p class="text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">Мин. ЕНТ</p>
<p class="tracking-tight text-3xl font-bold" id="stat-min-ent">--</p>
</div>
<div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
<p class="text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">Рейтинг</p>
<p class="tracking-tight text-3xl font-bold" id="stat-rating">--</p>
</div>
<div class="flex flex-col gap-2 rounded-xl p-6 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
<p class="text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">Тип</p>
<p class="tracking-tight text-3xl font-bold" id="stat-type">--</p>
</div>
<div class="flex items-center justify-center rounded-xl p-6 bg-accent-orange/10 border border-accent-orange/30">
<a href="#" id="add-to-compare-btn" class="flex w-full items-center justify-center gap-2 rounded-lg h-12 px-6 bg-accent-orange text-white text-base font-bold shadow-lg hover:bg-accent-orange/90 transition-colors">
<span class="material-symbols-outlined">compare_arrows</span>
<span class="truncate">Добавить к сравнению</span>
</a>
</div>
</div>
<div class="mt-8 lg:grid lg:grid-cols-4 lg:gap-8">
<aside class="hidden lg:block lg:col-span-1">
<div class="sticky top-24">
<nav class="flex flex-col gap-1">
<a class="flex items-center px-4 py-2.5 rounded-lg text-sm font-semibold bg-primary/10 text-primary border-l-4 border-primary" href="#about">Об университете</a>
<a class="flex items-center px-4 py-2.5 rounded-lg text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-100 dark:hover:bg-gray-700/50 border-l-4 border-transparent" href="#programs">Академические программы</a>
<a class="flex items-center px-4 py-2.5 rounded-lg text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-100 dark:hover:bg-gray-700/50 border-l-4 border-transparent" href="#admissions">Общежитие</a>
<a class="flex items-center px-4 py-2.5 rounded-lg text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-100 dark:hover:bg-gray-700/50 border-l-4 border-transparent" href="#3d-tour">Партнеры</a>
</nav>
</div>
</aside>
<div class="lg:col-span-3 space-y-8">
<div class="lg:hidden pb-3">
<div class="flex border-b border-border-light dark:border-border-dark overflow-x-auto">
<a class="flex flex-col items-center justify-center text-center whitespace-nowrap border-b-[3px] border-b-primary text-primary pb-3 pt-4 px-4" href="#about">
<p class="text-sm font-bold">Об университете</p>
</a>
<a class="flex flex-col items-center justify-center text-center whitespace-nowrap border-b-[3px] border-b-transparent text-text-secondary-light dark:text-text-secondary-dark pb-3 pt-4 px-4" href="#programs">
<p class="text-sm font-bold">Программы</p>
</a>
</div>
</div>
<div class="p-6 sm:p-8 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark" id="about">
<h2 class="text-2xl font-bold tracking-tight">Об университете</h2>
<p class="mt-4 text-text-secondary-light dark:text-text-secondary-dark leading-relaxed" id="uni-description">
                            ...
                        </p>
</div>
<div class="p-6 sm:p-8 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark" id="programs">
<h2 class="text-2xl font-bold tracking-tight">Академические программы</h2>
<p class="text-sm text-text-secondary-light dark:text-text-secondary-dark mt-2">
    **Группа ГОП (для гранта):** B057 (Информатика) | **Количество:** <span id="program-count">0</span> программ
</p>
<div class="mt-6 -mx-6 sm:-mx-8 overflow-x-auto">
<table class="min-w-full divide-y divide-border-light dark:divide-border-dark">
<thead class="bg-background-light dark:bg-background-dark">
<tr>
<th class="py-3.5 px-6 sm:px-8 text-left text-sm font-semibold" scope="col">Программа (Код)</th>
<th class="py-3.5 px-6 sm:px-8 text-left text-sm font-semibold" scope="col">Профессии</th>
<th class="py-3.5 px-6 sm:px-8 text-left text-sm font-semibold" scope="col">Мин. ЕНТ</th>
<th class="py-3.5 px-6 sm:px-8 text-left text-sm font-semibold" scope="col">Стоимость (₸/год)</th>
<th class="py-3.5 px-6 sm:px-8 text-left text-sm font-semibold" scope="col">Грант</th>
</tr>
</thead>
<tbody class="divide-y divide-border-light dark:divide-border-dark" id="programs-table-body">
    </tbody>
</table>
</div>
</div>

<div class="p-6 sm:p-8 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark" id="admissions">
    <h2 class="text-2xl font-bold tracking-tight">Общежитие</h2>
    <p class="mt-4 text-text-secondary-light dark:text-text-secondary-dark leading-relaxed" id="dormitory-status">
        </p>
</div>

<div class="p-6 sm:p-8 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark" id="international">
    <h2 class="text-2xl font-bold tracking-tight">Международное сотрудничество</h2>
    <div class="mt-4 flex flex-wrap gap-2" id="partnerships-list">
        </div>
</div>

<div class="relative rounded-xl overflow-hidden bg-cover bg-center min-h-80 flex flex-col justify-end p-6 sm:p-8" data-alt="University campus image" id="3d-tour-section">
<div class="relative z-10">
<h2 class="text-2xl font-bold tracking-tight text-white">Виртуальный 3D-тур</h2>
<p class="mt-2 text-white/80 max-w-lg">Исследуйте наш кампус, лаборатории и учебные аудитории не выходя из дома.</p>
<button id="3d-tour-button" class="flex mt-6 items-center justify-center gap-2 rounded-lg h-12 px-6 bg-accent-green text-white text-base font-bold shadow-lg hover:bg-accent-green/90 transition-colors">
<span class="material-symbols-outlined">view_in_ar</span>
<span class="truncate">Смотреть 3D-тур</span>
</button>
</div>
</div>
</div>
</div>
</main>
</div>

<script>
    const API_BASE_URL = 'http://127.0.0.1:8000/api';

    // Вспомогательная функция для форматирования денег
    function formatCurrency(amount) {
        if (amount === 0 || amount === null || isNaN(amount)) return 'Бесплатно';
        return new Intl.NumberFormat('ru-RU', { 
            style: 'currency', 
            currency: 'KZT', 
            minimumFractionDigits: 0 
        }).format(amount).replace('KZT', '₸');
    }

    // Извлечение ID из URL (vuz.html?id=X)
    function getUniversityId() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }

    async function loadUniversityDetails() {
        const uniId = getUniversityId();
        if (!uniId) {
            document.getElementById('uni-name').innerText = 'Ошибка: ID не указан';
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/universities/${uniId}`);
            if (!response.ok) {
                if (response.status === 404) {
                    document.getElementById('uni-name').innerText = 'Вуз не найден';
                } else {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return;
            }

            const data = await response.json();
            const uni = data.university || data; // Учитываем, что ответ может быть обернут или нет

            renderHeader(uni);
            renderStats(uni);
            renderPrograms(uni);
            renderDormitory(uni);
            renderPartnerships(uni);
            render3DTour(uni);

        } catch (error) {
            console.error("Ошибка при загрузке данных вуза:", error);
            document.getElementById('uni-name').innerText = `Ошибка загрузки: ${error.message}`;
        }
    }

    function renderHeader(uni) {
        document.getElementById('header-image-container').style.backgroundImage = 
            `linear-gradient(0deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 40%), url("${uni.tour_images.length ? uni.tour_images[0] : 'https://placehold.co/1200x400/137fec/white?text=Campus+Image'}")`;
        document.getElementById('uni-name').innerText = uni.name;
        document.getElementById('uni-name-breadcrumb').innerText = uni.name;
        document.getElementById('uni-city').innerText = `${uni.city}, Казахстан`;
        
        const compareBtn = document.getElementById('add-to-compare-btn');
        compareBtn.href = `sravnenie.html?add=${uni.id}`;
    }

    function renderStats(uni) {
        document.getElementById('stat-min-ent').innerText = uni.min_ent_score || '--';
        document.getElementById('stat-rating').innerText = uni.rating ? uni.rating.toFixed(1) : '--';
        document.getElementById('stat-type').innerText = uni.type || '--';
        document.getElementById('uni-description').innerText = uni.description || 'Описание отсутствует.';
    }

    function renderPrograms(uni) {
        const tableBody = document.getElementById('programs-table-body');
        tableBody.innerHTML = '';
        document.getElementById('program-count').innerText = uni.programs.length;

        uni.programs.forEach(prog => {
            const row = document.createElement('tr');
            const grantStatus = prog.grant_available 
                ? `<span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800 dark:bg-green-900/50 dark:text-green-300">Да (${prog.grant_percent}%)</span>`
                : `<span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:bg-red-900/50 dark:text-red-300">Нет</span>`;

            const careersList = prog.careers.length ? prog.careers.join(', ') : 'Специализации не указаны';

            row.innerHTML = `
                <tr>
                    <td class="whitespace-nowrap py-4 px-6 sm:px-8 text-sm font-medium">
                        ${prog.name} (${prog.group_code || prog.code || 'N/A'})
                    </td>
                    <td class="py-4 px-6 sm:px-8 text-sm text-text-secondary-light dark:text-text-secondary-dark max-w-xs leading-relaxed">
                        ${careersList}
                    </td>
                    <td class="whitespace-nowrap py-4 px-6 sm:px-8 text-sm text-text-secondary-light dark:text-text-secondary-dark">
                        ${prog.min_ent_score}
                    </td>
                    <td class="whitespace-nowrap py-4 px-6 sm:px-8 text-sm text-text-secondary-light dark:text-text-secondary-dark">
                        ${formatCurrency(prog.cost_per_year)}
                    </td>
                    <td class="whitespace-nowrap py-4 px-6 sm:px-8 text-sm text-text-secondary-light dark:text-text-secondary-dark">
                        ${grantStatus}
                    </td>
                </tr>
            `;
            tableBody.appendChild(row);
        });
    }

    function renderDormitory(uni) {
        const dormStatus = document.getElementById('dormitory-status');
        if (uni.dormitory && uni.dormitory.available) {
            const cost = uni.dormitory.cost_per_month 
                ? `Примерная стоимость: ${formatCurrency(uni.dormitory.cost_per_month)}/мес.`
                : `Стоимость не указана.`;
            dormStatus.innerHTML = `
                <p class="text-accent-green font-semibold">Общежитие доступно.</p>
                <p>${cost} За подробностями обращайтесь к администрации.
                </p>
            `;
        } else {
            dormStatus.innerHTML = '<p class="text-accent-orange font-semibold">Общежитие не предоставляется.</p>';
        }
    }
    
    function renderPartnerships(uni) {
        const list = document.getElementById('partnerships-list');
        list.innerHTML = '';
        if (uni.partnerships && uni.partnerships.length) {
            uni.partnerships.forEach(p => {
                const tag = document.createElement('span');
                tag.className = 'inline-flex items-center rounded-md bg-gray-100 px-2.5 py-0.5 text-sm font-medium text-gray-800 dark:bg-gray-700 dark:text-gray-300';
                tag.innerText = p;
                list.appendChild(tag);
            });
        } else {
            list.innerHTML = '<p class="text-text-secondary-light dark:text-text-secondary-dark">Международное сотрудничество не указано.</p>';
        }
    }

    function render3DTour(uni) {
        const tourSection = document.getElementById('3d-tour-section');
        const tourButton = document.getElementById('3d-tour-button');
        
        if (uni.tour_images && uni.tour_images.length) {
            // Используем первую картинку из массива tour_images для фона секции
            tourSection.style.backgroundImage = `linear-gradient(0deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.1) 50%), url("${uni.tour_images[0]}")`;
            tourButton.onclick = () => alert('Ссылка на 3D-тур: ' + uni.tour_images[0]); // Для демо - alert
        } else if (uni.website) {
            // Если нет картинок, но есть сайт, предлагаем посетить сайт
            tourButton.querySelector('.truncate').innerText = 'Перейти на сайт';
            tourButton.href = uni.website;
        } else {
            // Если нет ни тура, ни сайта, скрываем секцию
            tourSection.style.display = 'none';
        }
    }

    // Запуск загрузки данных при загрузке страницы
    loadUniversityDetails();
</script>
</body></html>